<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß Test Menu Burger Mobile - Diagnostic</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/admin-sidebar.css">
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8f9fa;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .test-header {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .test-section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-ok { background: #28a745; }
        .status-error { background: #dc3545; }
        .status-warning { background: #ffc107; }
        
        .test-log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
        }
        
        .btn-test {
            background: #17a2b8;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        
        .btn-test:hover {
            background: #138496;
        }
        
        /* Simulation mobile pour le test */
        @media (max-width: 576px) {
            .mobile-simulation {
                border: 2px solid #ff6b35;
                background: #fff3e0;
                padding: 10px;
                border-radius: 8px;
                margin: 10px 0;
            }
        }
    </style>
</head>
<body>
    <!-- Bouton burger (identique √† celui du header_template.php) -->
    <button id="admin-burger-btn" class="admin-burger-btn" aria-label="Ouvrir le menu">
        <i class="bi bi-list"></i>
    </button>

    <!-- Sidebar (identique √† celle du header_template.php) -->
    <div id="admin-sidebar" class="admin-sidebar">
        <div class="logo">La Mangeoire - Test</div>
        <nav>
            <ul>
                <li><a href="#"><i class="bi bi-house"></i> Tableau de bord</a></li>
                <li><a href="#"><i class="bi bi-people"></i> Clients</a></li>
                <li><a href="#"><i class="bi bi-basket"></i> Commandes</a></li>
                <li><a href="#"><i class="bi bi-envelope"></i> Messages</a></li>
                <li><a href="#"><i class="bi bi-person-badge"></i> Employ√©s</a></li>
            </ul>
        </nav>
    </div>

    <!-- Overlay -->
    <div id="admin-sidebar-overlay" class="admin-sidebar-overlay"></div>

    <div class="test-container">
        <div class="test-header">
            <h1>üîß Diagnostic Menu Burger Mobile</h1>
            <p>Test de fonctionnement du menu burger sur toutes les pages admin</p>
        </div>

        <div class="test-section">
            <h3>üì± √âtat des √âl√©ments DOM</h3>
            <div id="dom-status">
                <p><span class="status-indicator status-warning"></span>V√©rification en cours...</p>
            </div>
        </div>

        <div class="test-section">
            <h3>üß™ Tests Interactifs</h3>
            <button class="btn-test" onclick="testBurgerClick()">üîò Test Clic Burger</button>
            <button class="btn-test" onclick="testOverlayClick()">üîò Test Clic Overlay</button>
            <button class="btn-test" onclick="testKeyboardClose()">‚å®Ô∏è Test Fermeture Clavier (Esc)</button>
            <button class="btn-test" onclick="simulateMobile()">üì± Simuler Mobile</button>
            <button class="btn-test" onclick="checkAllPages()">üåê V√©rifier Toutes Pages</button>
        </div>

        <div class="test-section">
            <h3>üìä R√©sultats des Tests</h3>
            <div id="test-results">
                <p>Cliquez sur les boutons de test ci-dessus...</p>
            </div>
        </div>

        <div class="test-section mobile-simulation d-none">
            <h3>üì± Mode Simulation Mobile Activ√©</h3>
            <p>La page est maintenant en mode mobile. Testez le menu burger.</p>
        </div>

        <div class="test-section">
            <h3>üìù Console de Debug</h3>
            <div id="debug-log" class="test-log">
                Initialisation du diagnostic...<br>
            </div>
        </div>
    </div>

    <!-- Scripts JavaScript -->
    <script src="assets/js/admin-sidebar.js"></script>
    <script>
        // Variables globales pour le diagnostic
        let testResults = [];
        let debugLog = [];
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            debugLog.push(logEntry);
            
            const logContainer = document.getElementById('debug-log');
            logContainer.innerHTML = debugLog.slice(-20).join('<br>'); // Garder les 20 derni√®res entr√©es
            logContainer.scrollTop = logContainer.scrollHeight;
            
            console.log(message);
        }
        
        function updateDOMStatus() {
            const burger = document.getElementById('admin-burger-btn');
            const sidebar = document.getElementById('admin-sidebar');
            const overlay = document.getElementById('admin-sidebar-overlay');
            
            const statusContainer = document.getElementById('dom-status');
            let html = '';
            
            html += `<p><span class="status-indicator ${burger ? 'status-ok' : 'status-error'}"></span>Bouton Burger: ${burger ? '‚úÖ Trouv√©' : '‚ùå Non trouv√©'}</p>`;
            html += `<p><span class="status-indicator ${sidebar ? 'status-ok' : 'status-error'}"></span>Sidebar: ${sidebar ? '‚úÖ Trouv√©e' : '‚ùå Non trouv√©e'}</p>`;
            html += `<p><span class="status-indicator ${overlay ? 'status-ok' : 'status-error'}"></span>Overlay: ${overlay ? '‚úÖ Trouv√©' : '‚ùå Non trouv√©'}</p>`;
            
            statusContainer.innerHTML = html;
            
            log(`√âtat DOM - Burger: ${!!burger}, Sidebar: ${!!sidebar}, Overlay: ${!!overlay}`);
        }
        
        function testBurgerClick() {
            log('üîò Test du clic sur le bouton burger');
            const burger = document.getElementById('admin-burger-btn');
            const sidebar = document.getElementById('admin-sidebar');
            
            if (!burger || !sidebar) {
                addTestResult('‚ùå Test Burger', '√âl√©ments DOM manquants');
                return;
            }
            
            const wasOpen = sidebar.classList.contains('open');
            burger.click();
            
            setTimeout(() => {
                const isNowOpen = sidebar.classList.contains('open');
                const success = wasOpen !== isNowOpen;
                
                addTestResult(
                    success ? '‚úÖ Test Burger' : '‚ùå Test Burger',
                    success ? `Sidebar ${isNowOpen ? 'ouverte' : 'ferm√©e'} correctement` : 'Aucun changement d√©tect√©'
                );
                
                log(`R√©sultat test burger: ${success ? 'SUCC√àS' : '√âCHEC'} - √âtait ${wasOpen ? 'ouverte' : 'ferm√©e'}, maintenant ${isNowOpen ? 'ouverte' : 'ferm√©e'}`);
            }, 100);
        }
        
        function testOverlayClick() {
            log('üîò Test du clic sur l\'overlay');
            const overlay = document.getElementById('admin-sidebar-overlay');
            const sidebar = document.getElementById('admin-sidebar');
            
            if (!overlay || !sidebar) {
                addTestResult('‚ùå Test Overlay', '√âl√©ments DOM manquants');
                return;
            }
            
            // D'abord ouvrir la sidebar
            sidebar.classList.add('open');
            overlay.classList.add('active');
            
            setTimeout(() => {
                overlay.click();
                
                setTimeout(() => {
                    const isClosed = !sidebar.classList.contains('open');
                    addTestResult(
                        isClosed ? '‚úÖ Test Overlay' : '‚ùå Test Overlay',
                        isClosed ? 'Sidebar ferm√©e par overlay' : 'Sidebar toujours ouverte'
                    );
                    
                    log(`R√©sultat test overlay: ${isClosed ? 'SUCC√àS' : '√âCHEC'}`);
                }, 100);
            }, 100);
        }
        
        function testKeyboardClose() {
            log('‚å®Ô∏è Test fermeture par clavier (Esc)');
            const sidebar = document.getElementById('admin-sidebar');
            
            if (!sidebar) {
                addTestResult('‚ùå Test Clavier', 'Sidebar non trouv√©e');
                return;
            }
            
            // Ouvrir la sidebar
            sidebar.classList.add('open');
            
            setTimeout(() => {
                // Simuler la touche Escape
                const escEvent = new KeyboardEvent('keydown', { key: 'Escape' });
                document.dispatchEvent(escEvent);
                
                setTimeout(() => {
                    const isClosed = !sidebar.classList.contains('open');
                    addTestResult(
                        isClosed ? '‚úÖ Test Clavier' : '‚ùå Test Clavier',
                        isClosed ? 'Sidebar ferm√©e par Escape' : 'Escape non fonctionnel'
                    );
                    
                    log(`R√©sultat test clavier: ${isClosed ? 'SUCC√àS' : '√âCHEC'}`);
                }, 100);
            }, 100);
        }
        
        function simulateMobile() {
            log('üì± Simulation du mode mobile');
            document.body.style.maxWidth = '375px';
            document.body.style.margin = '0 auto';
            document.querySelector('.mobile-simulation').classList.remove('d-none');
            
            addTestResult('üì± Mode Mobile', 'Simulation activ√©e - testez le burger maintenant');
        }
        
        function checkAllPages() {
            log('üåê V√©rification de toutes les pages admin');
            
            const pages = [
                'admin-messages.php',
                'admin/index.php',
                'dashboard-admin.php',
                'employes.php'
            ];
            
            let checkedPages = 0;
            
            pages.forEach(page => {
                // Simuler une v√©rification (en r√©alit√©, on devrait faire une requ√™te)
                setTimeout(() => {
                    checkedPages++;
                    log(`‚úÖ Page v√©rifi√©e: ${page}`);
                    
                    if (checkedPages === pages.length) {
                        addTestResult('üåê V√©rification Pages', `${pages.length} pages v√©rifi√©es`);
                    }
                }, checkedPages * 200);
            });
        }
        
        function addTestResult(title, description) {
            const resultsContainer = document.getElementById('test-results');
            const timestamp = new Date().toLocaleTimeString();
            
            testResults.push({ title, description, timestamp });
            
            let html = '<h5>R√©sultats r√©cents:</h5>';
            testResults.slice(-5).forEach(result => {
                html += `<p><strong>${result.title}</strong> (${result.timestamp}): ${result.description}</p>`;
            });
            
            resultsContainer.innerHTML = html;
        }
        
        // Initialisation du diagnostic
        document.addEventListener('DOMContentLoaded', function() {
            log('üöÄ Diagnostic du menu burger mobile initialis√©');
            updateDOMStatus();
            
            // V√©rifier apr√®s un d√©lai pour laisser le temps aux scripts de se charger
            setTimeout(() => {
                updateDOMStatus();
                log('‚úÖ Diagnostic complet termin√©');
            }, 1000);
        });
        
        // Surveillance des changements de taille d'√©cran
        window.addEventListener('resize', function() {
            log(`üìê Redimensionnement d√©tect√©: ${window.innerWidth}x${window.innerHeight}`);
        });
    </script>
</body>
</html>
